{% trans_default_domain('service.admin') %}

{% macro make_reserve(item, date, price) %}
    {#    <a #}
    {#        href="{{ path('services:admin.basket', { #}
    {#            service: item.serviceId, #}
    {#            period: item.periodId, #}
    {#            date: date| date("Y-m-d"), #}
    {#            event: item.serviceEvent #}
    {#        }) }}" #}
    {#        class="btn-link text-decoration-none w-100 modal-link disabled" #}
    {#        data-bs-toggle=modal #}
    {#        data-bs-target="#modal" #}
    {#    > #}
    {#        {{ money(price, item.serviceCurrency) }} #}
    {#    </a> #}

    <span>{{ money(price, item.serviceCurrency) }}</span>
{% endmacro %}

<main class="main d-print-none ">

    <section class="container px-4 mb-5">

        {# breadcrumb #}
        <div class="mt-3 d-flex justify-content-between">
            {{ include(_self|replace({ "content.html.twig": "_breadcrumb.html.twig" })) }}
        </div>

        <h2>Расписание услуги "{{ name }}"</h2>

        {# Слоты #}
        {% for p, period in periods %}

            <div style="display: flex; flex-direction: row">
                <div class="{{ period ? "p-2" : "p-4" }}"
                     style="  {{ period ? "border:1px solid #000088;" : "" }} height: 50px; width: 100px; display: flex;align-items: center; box-shadow: 1px 1px 3px 1px #c0ced4;">
                    {% if period %}
                        <span>{{ period.timeFrom| date("H:i") }}</span> -
                        <span>{{ period.timeTo| date("H:i") }}</span>
                    {% endif %}

                </div>

                {# Даты #}
                {% for k, date in dates %}

                    {% if p == 0 %}
                        <div class="ps-2 "
                             style="border: 1px solid #000088; height: 50px; width: 100px; display: flex; align-items: center;">
                            {{ date|format_datetime(pattern="EE, d MMM") }}  {# date("m-d, D") #}
                        </div>
                    {% else %}
                        <div class="p-2"
                             style="border: 1px solid #000088; height: 50px; width: 100px; display: flex;align-items: center; background-color: #c0ced4; box-shadow: 1px 1px 3px 1px #c0ced4;"
                             title="Заказать '{{ name }}' на {{ date| date("Y:m:d") }} {{ period.timeFrom| date("H:i") }} - {{ period.timeTo| date("H:i") }}"
                        >
                            {% if period %}

                                {# TODO Персональная скидка #}
                                {% set price = user_profile_discount(period.servicePrice) ?: period.servicePrice %}

                                <div class="p-2">

                                    {# Получить данные по order service data #}
                                    {% if period.getOrderServicesData %}

                                        {% set has_service_order = false %}
                                        {% for order_service_data in period.getOrderServicesData %}

                                            {% if order_service_data and (order_service_data.order_service_date|date("Y-m-d")) == date| date("Y-m-d") %}

                                                {% set has_service_order = true %}
                                                <div class="bg-warning">Резерв</div>

                                            {% endif %}

                                        {% endfor %}

                                        {# Слот свободен #}
                                        {% if has_service_order == false %}

                                            {{ _self.make_reserve(period, date, price) }}
                                        {% endif %}

                                    {% else %}
                                        {{ _self.make_reserve(period, date, price) }}
                                    {% endif %}

                                </div>

                            {% endif %}

                        </div>
                    {% endif %}

                {% endfor %}

            </div>

        {% endfor %}

    </section>

</main>